## 网络应用体系结构

### CS结构

- 客户机

  - 与服务器通信，使用服务器提供的服务
  - 间歇性提供服务
  - 可能使用动态IP地址
  - 不会与其他客户机直接通信

  

- 服务器

  - 7*24提供服务
  - 永久性访问地址/域名
  - 利用大量服务器实现可扩展性

  例如，web：

  ![image-20210216111858910](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210216111858910.png)

### P2P结构

- 特点
  - 没有永远在线的服务器
  - 任意端节点可直接通讯
  - 节点间歇性接入网络
  - 节点可能改变IP地址
- 高度可伸缩
- 难以管理



### 混合结构

- 例子

![image-20210216112159872](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210216112159872.png)

![image-20210216112237634](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210216112237634.png)

其中文件属性用于查询。



## 进程间通信

- ### 类型

  - 同一主机：进程间通信机制、操作系统提供
  - 不同主机：消息交换 

  - 在应用中，分为客户机进程和服务器进程。客户机进程发起通信请求，服务器进程等待通信请求。

- ### 实现：Socket

  - 通过Socket对下层网络协议的抽象，来使用网络协议。

  ![image-20210216113005041](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210216113005041.png)



- ### 寻址进程

  - 寻址主机：IP地址
  - 寻址进程：Port number，端口号
    - HTTP Server：80
    - Mail Server：25
  - 所以，进程的标识符就是IP地址+端口号

- ### 应用层协议

  - 公开，由RFC定义
  - 私有
  - 举例
    - HTTP
    - SMTP

![image-20210216113947557](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210216113947557.png)



### web应用

- WWW：无数个网页；网页相互连接。遵循HTTP协议。
- 对象：web page 包含多个对象
  - 对象的寻址：URL，统一资源定位器。（Scheme://host:port/path）
- c/s结构：
  - 客户：Browser，请求，接收，展示Web对象。
  - 服务器：响应客户的请求，发送对象。
- 使用TCP传输服务的过程：
  1. 服务器在80端口等待客户的请求
  2. 浏览器发起到服务器的TCP连接（创捷套接字Socket）
  3. 服务器接受来自浏览器的TCP的连接
  4. 浏览器（HTTP客户端）与WEB服务器交换HTTP消息
  5. 关闭TCP连接
- 无状态
  - 服务器不维护任何有关客户端过去所发请求的信息
  - 无状态更简单、可靠、易维护



## HTTP连接的两种类型

- ### 非持久性连接

  - 每个TCP连接最多允许传输一个对象

  - HTTP1.0版本使用

  - ![image-20210218104819309](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210218104819309.png)

    ![image-20210218110424321](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210218110424321.png)

  - 问题：每个对象需要2个RTT；操作系统需要为每个TCP连接开销资源。

- ### 持久性连接

  - 每个TCP连接允许传输多个对象
  - HTTP1.1版本默认使用带流水机制的持久性连接
  - 类型：
    - 无流水的持久性连接：客户端只有收到前一个响应后才发送新请求，每个对象1个RTT
    - 带有流水机制的持久性连接：客户端遇到一个引用对象就尽快发出请求



## HTTP请求消息的格式

- ### 请求消息（ASCII）

  - ![image-20210218120109243](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210218120109243.png)

  - ![image-20210218120127170](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210218120127170.png)

  - EntityBody就是要发送的数据

  - ![image-20210218120251744](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210218120251744.png)

    ![image-20210218120354749](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210218120354749.png)

    

  

- 响应消息

  - ![image-20210218120645258](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210218120645258.png)
  - ![image-20210218120931163](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210218120931163.png)

## cookie

- ### 为什么需要？

  - HTTP协议无状态，但是又需要掌握客户端的状态，所以某些网站为了能辨别用户身份、进行session跟踪而存储在用户本地终端上的数据，通常是经过了加密的。

- ### cookie的组件：

  - HTTP响应消息的cookie头部行
  - HTTP请求消息的cookie头部行
  - 保存在client 主机上的cookie文件，由浏览器管理
  - Web服务器的后台数据库

- ### 原理

  ![image-20210218121445432](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210218121445432.png)

   



## Web缓存/代理服务器技术

- ![image-20210218122121849](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210218122121849.png)
- ![image-20210218122342640](C:\Users\hyp19\AppData\Roaming\Typora\typora-user-images\image-20210218122342640.png)
- 