# TODO

- [ ] Oauth2 里的callback 

- [ ] Oauth2 里的jwt流程

- [ ] Spawner合并（流程图）

- [ ] single-user app 和hub是什么关系，如何交互（接口）

  
  
  
  
- [ ] 其他备忘

  - [ ] 在base.py里面分析一下cook和session和token之间的关系。
  - [ ] 登录的过程基本清楚了，还需要画一个流程图。（base.py的login_user()）

  



- 工程的调研任务

  - git版本控制

    - 所有lab和git相关的插件，研究架构
    - 实现git，需要怎么做，（C/S架构，而不是本地存储），初步方案

  - 合作实验（不算工作任务）

    - hub、single-user server、另一台访问能使用hub调server，分别使用两个不同的地址（同一个网段），实现hub能把server调起来

    - 网络访问和跨域问题

    - 结合官方文档，配置项可以改

    - 实验计划

      

- 阶段总结，OKR

  - 个人的感悟、思考



# 具体执行





# 文档输出

## 认证流程

### Token方式

使用Authorization的方法传递token



## OAuth2







## spawner









## lab的git版本控制 调研





## single-user app与hub的交互





## 数据库

- users

| 字段                 | 含义                                | 类型         | 备注 |
| -------------------- | ----------------------------------- | ------------ | ---- |
| id                   |                                     | Integer      |      |
| name                 |                                     | Unicode(255) |      |
| _orm_spawners        | spawner的状态（？）                 |              |      |
| admin                |                                     | Boolean      |      |
| created              | 创建时间                            | DateTime     |      |
| last_activity        | 上次动作的时间                      | DateTime     |      |
| api_tokens           |                                     |              |      |
| oath_tokens          |                                     |              |      |
| cookie_id            |                                     | Unicode(255) |      |
| state                | 用户的状态（其实就是spawner的状态） | JSONDict     |      |
| encrypted_auth_state | Authenticators的状态（？）          | LargeBinary  |      |



## 其他

- 刷新用户身份的函数 refresh_user(user, hansdler = none)
  - 当用户身份验证信息已经是最新的了，则返回true
  - 当用户的身份验证信息已经过期了，则返回false
  - 当用户的某些字段需要更新时，返回一个与authenticate()返回的字典相同结构的数据，里面存在的字段将刷新用户的值。
  - auth_to_user()这个函数将会更新返回的需要更新的字段。



