# Commands和Menus：扩展主应用程序
## 在原来的extension基础上修改成一个新的extension
- 在package.json里修改包名为新的包名
- 在src/index.ts里修改包名

## JupyterLab命令面板
JupyterLab命令面板可以看作是一个由JupyterLab执行的操作的列表。  
要在扩展中实现命令面板中的一项（一个命令），需要在application command registry（应用命令注册表）中添加一个命令，并在命令面板中显示给用户。扩展负责向JupyterLab命令注册表提供一系列的函数，然后可以通过命令面板或者菜单将其显示给用户。  
实现以上功能需要CommandRegistry（注册表）和ICommandPalette（命令面板界面）。首先导入ICommandPalette：
```
import {
  ICommandPalette
} from '@JupyterLab/apputils';
```
## 接下来在activate函数中实现上述功能，在命令面板中添加新的命令item：
```
const extension: JupyterLabPlugin<void> = {
    id: '2_commands_and_menus',
    autoStart: true,
    requires: [ICommandPalette],
    activate: (
        app: JupyterLab,
        palette: ICommandPalette) =>
    {
        const { commands } = app;

        let command = 'labtutorial';
        let category = 'Tutorial';

        commands.addCommand(command, {
            label: 'New Labtutorial',
            caption: 'Open the Labtutorial',
            execute: (args) => {console.log('Hey')}});

        palette.addItem({command, category});
    }
};

export default extension;
```
在以上代码中，将extension的requires属性设置为[ICommendPalette]。
向activate中传入的参数有两个，分别是app(JupyterLab类型)以及palette(ICommandPalette类型)。其中，app.commands提供addCommand方法，可以将一个函数添加到CommandRegistry中(CammandRegistry命令注册表是JupyterLab的一个属性)；而ICommandRegistry提供addItem方法，可以将命令注册表中的一个命令链接到命令面板界面的一个新的命令项中。

然后build一下这个扩展，就可以在命令面板中找到这个扩展实现的那个命令了。

## 在菜单栏中添加新的菜单tabs和items
和添加命令非常类似。
首先导入IMainMenu和Menu：
```
import {
  IMainMenu
} from '@JupyterLab/mainmenu';

import {
  Menu
} from '@phosphor/widgets';
```
然后在下面的extension中，将IMainMenu添加到其requires属性中，以便能在activate函数中使用它。
**？为什么不用加入Menu呢？**
```
const extension: JupyterLabPlugin<void> = {
    id: '2_commands_and_menus',
    autoStart: true,
    requires: [ICommandPalette, IMainMenu],
    activate: (
        app: JupyterLab,
        palette: ICommandPalette,
        mainMenu: IMainMenu) =>
    {
        const { commands } = app;
        let command = 'labtutorial';
        let category = 'Tutorial';
        commands.addCommand(command, {
            label: 'New Labtutorial',
            caption: 'Open the Labtutorial',
            execute: (args) => {console.log('Hey')}});
        palette.addItem({command, category});

        let tutorialMenu: Menu = new Menu({commands});

        tutorialMenu.title.label = 'Tutorial';
        mainMenu.addMenu(tutorialMenu, {rank: 80});
        tutorialMenu.addItem({ command });
    }
};

export default extension;
```
在上述代码中， mainMenu:IMainMenu使用addMenu方法将tutorialMenu:Menu添加到了菜单栏，成为一项菜单；tutorialMenu:Menu使用addItem方法将cammand添加到了这项菜单里；而commands:JupyterLab.commands使用addCommand方法将cammand与一系列属性和执行函数绑定。按我的理解，mainMenu可以看成菜单栏，而tutorialMenu可以看成菜单栏里的一项菜单，command是这项菜单里的一个具体的菜单项，它与将要执行的函数进行绑定。  
接下来别忘了更改package.json：
```
  "dependencies": {
    "@JupyterLab/application": "^0.16.0",
    "@JupyterLab/mainmenu": "*",
    "@phosphor/widgets": "*"
  }
```
tsconfig.json文件可能需要更改为：
```
{
  "compilerOptions": {
    "declaration": true,
    "noImplicitAny": true,
    "noEmitOnError": true,
    "noUnusedLocals": true,
    "module": "commonjs",
    "moduleResolution": "node",
    "target": "ES6",
    "outDir": "./lib",
    "lib": ["ES6", "ES2015.Promise", "DOM"],
    "types": []
  },
  "include": ["src/*"]
}
```
然后就可以执行：
```
npm install
npm run build
```

